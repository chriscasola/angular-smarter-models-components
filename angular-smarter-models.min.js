var AngularSmarterModels;!function(t){t.smModule=angular.module("sm.models",[])}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t,angular.isObject(this.config.rawModel)||(this.config.rawModel={})}return Object.defineProperty(t.prototype,"props",{get:function(){return this.config.rawModel},enumerable:!0,configurable:!0}),t.prototype.serialize=function(){return JSON.stringify(this.config.rawModel)},t.prototype.merge=function(t){angular.extend(this.config.rawModel,t)},t.prototype.setModelPath=function(t){this.config.modelPath=t},t.prototype.getModelPath=function(){return this.config.modelPath},t.prototype.save=function(){return this.config.modelDataRetriever.save(this)},t.prototype["delete"]=function(){return this.config.modelDataRetriever["delete"](this.config.modelPath,this.config.listPath,this.config.idField)},t}();t.ModelInstance=e,t.smModule.value("SMModelInstance",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t}return t.prototype.get=function(t){return this.config.modelDataRetriever.get(this.config.modelPath,this.config.listPath,t,this.config.ModelInstance,this.config.idField)},t.prototype.getAsync=function(t){return this.config.modelDataRetriever.getAsync(this.config.modelPath,this.config.listPath,t,this.config.ModelInstance,this.config.idField)},t.prototype.list=function(t){return this.config.modelDataRetriever.list(this.config.listPath,this.config.modelPath,t,this.config.idField)},t.prototype.listAsync=function(t){return this.config.modelDataRetriever.listAsync(this.config.listPath,this.config.modelPath,t,this.config.idField)},t.prototype.create=function(t,e){var r=this.config.modelPath.split("/").slice(0,-1).join("/")+"/";return this.config.modelDataRetriever.create(r,this.config.listPath,t,new this.config.ModelInstance({rawModel:e,modelDataRetriever:this.config.modelDataRetriever,modelPath:this.config.modelPath,idField:this.config.idField}))},t}();t.Model=e,t.smModule.value("SMModel",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this._config=t}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config.config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"props",{get:function(){return this._config.rawModel},enumerable:!0,configurable:!0}),t}();t.ModelListItemInstance=e,t.smModule.value("SMModelListItemInstance",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t}return Object.defineProperty(t.prototype,"props",{get:function(){return void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"error",{get:function(){return this.config.error},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this.config.time},enumerable:!0,configurable:!0}),t}();t.ModelError=e}(AngularSmarterModels||(AngularSmarterModels={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},AngularSmarterModels;!function(t){function e(t,e){return t.split("/").map(function(n){if(":"===n[0]){var o=e[n.slice(1)];if(null!==o&&void 0!==o)return o;throw new r('Missing required param "'+n.slice(1)+'" for path "'+t+'"!')}return n}).join("/")}var r=function(t){function e(e){t.call(this,e),this.name="ModelDataRetrieverError"}return __extends(e,t),e}(Error);t.ModelDataRetrieverError=r;var n=1e4,o=function(){function o(t,e){this.$q=t,this.$http=e,this.modelCache={},this.outstandingRequests={},this.listCache={}}return o.prototype.cacheModel=function(t,e,r,n,o){var i=this,s=new r({rawModel:n,modelDataRetriever:i,modelPath:t,listPath:e,idField:o});return this.modelCache[t]=s,this.addModelToList(e,s,0),s},o.prototype.cacheError=function(e,r,n){var o=new t.ModelError({error:"An error occurred fetching the model!",time:Date.now()});return this.modelCache[e]=o,o},o.prototype.cacheList=function(t,e){return this.listCache[t]=e,e},o.prototype.hasListCache=function(t){var e=this.listCache[t];return this.listCache.hasOwnProperty(t)&&null!==e},o.prototype.shouldRetryFetch=function(t){return Date.now()-t.time>n},o.prototype.addModelToList=function(t,e,r){if(void 0===r&&(r=0),this.hasListCache(t)){for(var n=this.listCache[t],o=0;o<n.length;o++)if(n[o].props[e.config.idField]===e.props[e.config.idField])return void(n[o]=e);this.listCache[t].splice(r,0,e)}},o.prototype.removeModelFromList=function(t,e,r){for(var n=this.listCache[t],o=0;o<n.length;o++)if(n[o].props[r]===e){n.splice(o,1);break}},o.prototype.get=function(r,n,o,i,s){var a=e(r,o),l=this.modelCache[a],c=this.modelCache.hasOwnProperty(a);return(!c||l instanceof t.ModelError&&this.shouldRetryFetch(l))&&this.getAsync(r,n,o,i,s),c?l:void 0},o.prototype.getAsync=function(r,n,o,i,s){var a,l=this,c=e(r,o),u=this.modelCache[c];return!this.modelCache.hasOwnProperty(c)||u instanceof t.ModelError?this.outstandingRequests.hasOwnProperty(c)?a=this.outstandingRequests[c]:(a=this.$http.get(c).then(function(t){return l.cacheModel(c,n,i,t.data,s)})["catch"](function(t){return l.$q.reject(l.cacheError(c,n,s))})["finally"](function(){delete l.outstandingRequests[c]}),this.outstandingRequests[c]=a):a=this.$q.when(u),a},o.prototype.getMultiple=function(t,n,o,i,s){var a,l=this,c=e(t,o);return this.outstandingRequests.hasOwnProperty(c)?a=this.outstandingRequests[c]:(a=this.$http.get(c).then(function(t){return angular.isArray(t.data)?t.data.map(function(t){return l.cacheModel(c+"/"+t[s],n,i,t,s)}):l.$q.reject(new r('Expected array of models for getMultiple request for path "'+c+'"!'))})["finally"](function(){delete l.outstandingRequests[c]}),this.outstandingRequests[c]=a),a},o.prototype.list=function(t,r,n,o){var i=e(t,n);return this.hasListCache(i)?this.listCache[i]:void(null!==this.listCache[i]&&this.listAsync(t,r,n,o))},o.prototype.listAsync=function(n,o,i,s){var a,l=this,c=e(n,i);return this.hasListCache(c)?a=this.$q.when(this.listCache[c]):this.outstandingRequests.hasOwnProperty(c)?a=this.outstandingRequests[c]:(a=this.$http.get(c).then(function(n){if(!angular.isArray(n.data))return l.$q.reject(new r('Expected array of models for list request for path "'+c+'"!'));var a=n.data.map(function(r){var n=(c={},c[s]=r[s],c);angular.extend(n,i);var a=e(o,n);return l.modelCache.hasOwnProperty(a)?l.modelCache[a]:new t.ModelListItemInstance({rawModel:r,config:{idField:s}});var c});return l.cacheList(c,a)})["catch"](function(t){return l.listCache[c]=null,l.$q.reject(t)})["finally"](function(){delete l.outstandingRequests[c]}),this.outstandingRequests[c]=a),a},o.prototype.save=function(t){return this.$http.post(t.getModelPath(),t.serialize()).then(function(t){})},o.prototype.create=function(t,r,n,o){var i=this,s=e(t,n);return this.$http.put(s,o.serialize()).then(function(t){return o.merge(t.data),i.modelCache[t.headers("Location")]=o,i.addModelToList(r,o),o})},o.prototype["delete"]=function(t,e,r){var n,o=this;return this.modelCache.hasOwnProperty(t)&&(n=this.modelCache[t].props[r]),delete this.modelCache[t],this.$http["delete"](t).then(function(t){null!=n&&o.removeModelFromList(e,n,r)})},o.$inject=["$q","$http"],o}();t.ModelDataRetriever=o;var i={setRetryInterval:function(t){n=t},$get:["$injector",function(t){return t.instantiate(o)}]};t.smModule.value("smModelDataRetrieverError",r).provider("smModelDataRetriever",i)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){function e(t,e,n){var o=function(o,i){return new r(o,i,t,e,n,"id")};return o}var r=function(){function t(t,e,r,n,o,i){this.route=t,this._listPath=e,this.Model=r,this.ModelInstance=n,this._modelDataRetriever=o,this._idField=i}return t.prototype.model=function(t){return this.Model=t,this},t.prototype.modelInstance=function(t){return this.ModelInstance=t,this},t.prototype.modelDataRetriever=function(t){return this._modelDataRetriever=t,this},t.prototype.listPath=function(t){return this._listPath=t,this},t.prototype.idField=function(t){return this._idField=t,this},t.prototype.done=function(){return new this.Model({modelPath:this.route,ModelInstance:this.ModelInstance,modelDataRetriever:this._modelDataRetriever,listPath:this._listPath,idField:this._idField})},t}();t.ModelBuilder=r,e.$inject=["SMModel","SMModelInstance","smModelDataRetriever"],angular.module("sm.models").factory("smModelFactory",e)}(AngularSmarterModels||(AngularSmarterModels={}));
//# sourceMappingURL=angular-smarter-models.min.js.map