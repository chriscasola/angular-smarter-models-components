var AngularSmarterModels;!function(t){t.smModule=angular.module("sm.models",[])}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t,angular.isObject(this.config.rawModel)||(this.config.rawModel={})}return Object.defineProperty(t.prototype,"props",{get:function(){return this.config.rawModel},enumerable:!0,configurable:!0}),t.prototype.serialize=function(){return JSON.stringify(this.config.rawModel)},t.prototype.merge=function(t){angular.extend(this.config.rawModel,t)},t.prototype.setModelPath=function(t){this.config.modelPath=t},t.prototype.getModelPath=function(){return this.config.modelPath},t.prototype.save=function(){return this.config.modelDataRetriever.save(this)},t.prototype["delete"]=function(){return this.config.modelDataRetriever["delete"](this.config.modelPath,this.config.listPath,this.config.idField)},t}();t.ModelInstance=e,t.smModule.value("SMModelInstance",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t}return t.prototype.get=function(t){return this.config.modelDataRetriever.get(this.config.modelPath,this.config.listPath,t,this.config.ModelInstance,this.config.idField)},t.prototype.getAsync=function(t){return this.config.modelDataRetriever.getAsync(this.config.modelPath,this.config.listPath,t,this.config.ModelInstance,this.config.idField)},t.prototype.list=function(t){return this.config.modelDataRetriever.list(this.config.listPath,this.config.modelPath,t,this.config.idField)},t.prototype.listAsync=function(t){return this.config.modelDataRetriever.listAsync(this.config.listPath,this.config.modelPath,t,this.config.idField)},t.prototype.getMultipleAsync=function(t){var e=this.config.modelPath.split("/").slice(0,-1).join("/")+"/";return"/"===e.slice(-1)&&(e=e.slice(0,-1)),this.config.modelDataRetriever.getMultipleAsync(e,this.config.listPath,t,this.config.ModelInstance,this.config.idField)},t.prototype.create=function(t,e){var r=this.config.modelPath.split("/").slice(0,-1).join("/")+"/";return this.config.modelDataRetriever.create(r,this.config.listPath,t,new this.config.ModelInstance({rawModel:e,modelDataRetriever:this.config.modelDataRetriever,modelPath:this.config.modelPath,idField:this.config.idField}))},t}();t.Model=e,t.smModule.value("SMModel",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this._config=t}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config.config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"props",{get:function(){return this._config.rawModel},enumerable:!0,configurable:!0}),t}();t.ModelListItemInstance=e,t.smModule.value("SMModelListItemInstance",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t}return Object.defineProperty(t.prototype,"props",{get:function(){return void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"error",{get:function(){return this.config.error},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this.config.time},enumerable:!0,configurable:!0}),t}();t.ModelError=e}(AngularSmarterModels||(AngularSmarterModels={}));var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},AngularSmarterModels;!function(t){function e(t,e){return t.split("/").map(function(i){if(":"===i[0]){var n=e[i.slice(1)];if(null!==n&&void 0!==n)return n;throw new r('Missing required param "'+i.slice(1)+'" for path "'+t+'"!')}return i}).join("/")}var r=function(t){function e(e){t.call(this,e),this.message=e,this.name="ModelDataRetrieverError"}return __extends(e,t),e}(Error);t.ModelDataRetrieverError=r;var i=1e4,n=function(){function n(t,e){this.$q=t,this.$http=e,this.modelCache={},this.outstandingRequests={},this.listCache={}}return n.prototype.cacheModel=function(t,e,r,i,n){var o=this,s=new r({rawModel:i,modelDataRetriever:o,modelPath:t,listPath:e,idField:n});return this.modelCache[t]=s,this.addModelToList(e,s,0),s},n.prototype.cacheError=function(e,r,i){var n=new t.ModelError({error:"An error occurred fetching the model!",time:Date.now()});return this.modelCache[e]=n,n},n.prototype.cacheList=function(t,e){return this.listCache[t]=e,e},n.prototype.hasListCache=function(t){var e=this.listCache[t];return this.listCache.hasOwnProperty(t)&&null!==e},n.prototype.shouldRetryFetch=function(t){return Date.now()-t.time>i},n.prototype.addModelToList=function(t,e,r){if(void 0===r&&(r=0),this.hasListCache(t)){for(var i=this.listCache[t],n=0;n<i.length;n++)if(i[n].props[e.config.idField]===e.props[e.config.idField])return void(i[n]=e);this.listCache[t].splice(r,0,e)}},n.prototype.removeModelFromList=function(t,e,r){for(var i=this.listCache[t],n=0;n<i.length;n++)if(i[n].props[r]===e){i.splice(n,1);break}},n.prototype.get=function(r,i,n,o,s){var a=e(r,n),l=this.modelCache[a],c=this.modelCache.hasOwnProperty(a);return(!c||l instanceof t.ModelError&&this.shouldRetryFetch(l))&&this.getAsync(r,i,n,o,s),c?l:void 0},n.prototype.getAsync=function(r,i,n,o,s){var a,l=this,c=e(r,n),h=this.modelCache[c];return!this.modelCache.hasOwnProperty(c)||h instanceof t.ModelError?this.outstandingRequests.hasOwnProperty(c)?a=this.outstandingRequests[c]:(a=this.$http.get(c).then(function(t){return l.cacheModel(c,i,o,t.data,s)})["catch"](function(t){return l.$q.reject(l.cacheError(c,i,s))})["finally"](function(){delete l.outstandingRequests[c]}),this.outstandingRequests[c]=a):a=this.$q.when(h),a},n.prototype.getMultipleAsync=function(t,i,n,o,s){var a,l=this,c=e(t,n);return this.outstandingRequests.hasOwnProperty(c)?a=this.outstandingRequests[c]:(a=this.$http.get(c).then(function(t){return angular.isArray(t.data)?t.data.map(function(t){return l.cacheModel(c+"/"+t[s],i,o,t,s)}):l.$q.reject(new r('Expected array of models for getMultiple request for path "'+c+'"!'))})["finally"](function(){delete l.outstandingRequests[c]}),this.outstandingRequests[c]=a),a},n.prototype.list=function(t,r,i,n){var o=e(t,i);return this.hasListCache(o)?this.listCache[o]:void(null!==this.listCache[o]&&this.listAsync(t,r,i,n))},n.prototype.listAsync=function(i,n,o,s){var a,l=this,c=e(i,o);return this.hasListCache(c)?a=this.$q.when(this.listCache[c]):this.outstandingRequests.hasOwnProperty(c)?a=this.outstandingRequests[c]:(a=this.$http.get(c).then(function(i){if(!angular.isArray(i.data))return l.$q.reject(new r('Expected array of models for list request for path "'+c+'"!'));var a=i.data.map(function(r){var i=(c={},c[s]=r[s],c);angular.extend(i,o);var a=e(n,i);return l.modelCache.hasOwnProperty(a)?l.modelCache[a]:new t.ModelListItemInstance({rawModel:r,config:{idField:s}});var c});return l.cacheList(c,a)})["catch"](function(t){return l.listCache[c]=null,l.$q.reject(t)})["finally"](function(){delete l.outstandingRequests[c]}),this.outstandingRequests[c]=a),a},n.prototype.save=function(t){return this.$http.post(t.getModelPath(),t.serialize()).then(function(t){})},n.prototype.create=function(t,r,i,n){var o=this,s=e(t,i);return this.$http.put(s,n.serialize()).then(function(t){return n.merge(t.data),o.modelCache[t.headers("Location")]=n,o.addModelToList(r,n),n})},n.prototype["delete"]=function(t,e,r){var i,n=this;return this.modelCache.hasOwnProperty(t)&&(i=this.modelCache[t].props[r]),delete this.modelCache[t],this.$http["delete"](t).then(function(t){null!=i&&n.removeModelFromList(e,i,r)})},n.$inject=["$q","$http"],n}();t.ModelDataRetriever=n;var o={setRetryInterval:function(t){i=t},$get:["$injector",function(t){return t.instantiate(n)}]};t.smModule.value("smModelDataRetrieverError",r).provider("smModelDataRetriever",o)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){function e(t,e,i){var n=function(n,o){return new r(n,o,t,e,i,"id")};return n}var r=function(){function t(t,e,r,i,n,o){this.route=t,this._listPath=e,this.Model=r,this.ModelInstance=i,this._modelDataRetriever=n,this._idField=o}return t.prototype.model=function(t){return this.Model=t,this},t.prototype.modelInstance=function(t){return this.ModelInstance=t,this},t.prototype.modelDataRetriever=function(t){return this._modelDataRetriever=t,this},t.prototype.listPath=function(t){return this._listPath=t,this},t.prototype.idField=function(t){return this._idField=t,this},t.prototype.done=function(){return new this.Model({modelPath:this.route,ModelInstance:this.ModelInstance,modelDataRetriever:this._modelDataRetriever,listPath:this._listPath,idField:this._idField})},t}();t.ModelBuilder=r,e.$inject=["SMModel","SMModelInstance","smModelDataRetriever"],angular.module("sm.models").factory("smModelFactory",e)}(AngularSmarterModels||(AngularSmarterModels={}));
//# sourceMappingURL=angular-smarter-models.min.js.map