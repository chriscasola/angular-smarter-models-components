var AngularSmarterModels;!function(t){t.smModule=angular.module("sm.models",[])}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t}return Object.defineProperty(t.prototype,"props",{get:function(){return this.config.rawModel},enumerable:!0,configurable:!0}),t.prototype.serialize=function(){return JSON.stringify(this.config.rawModel)},t.prototype.merge=function(t){angular.extend(this.config.rawModel,t)},t.prototype.setModelPath=function(t){this.config.modelPath=t},t.prototype.getModelPath=function(){return this.config.modelPath},t.prototype.save=function(){return this.config.modelDataRetriever.save(this)},t.prototype["delete"]=function(){return this.config.modelDataRetriever["delete"](this.config.modelPath,this.config.listPath)},t}();t.ModelInstance=e,t.smModule.value("SMModelInstance",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t}return t.prototype.get=function(t){return this.config.modelDataRetriever.get(this.config.modelPath,this.config.listPath,t,this.config.ModelInstance,this.config.idField)},t.prototype.getAsync=function(t){return this.config.modelDataRetriever.getAsync(this.config.modelPath,this.config.listPath,t,this.config.ModelInstance,this.config.idField)},t.prototype.list=function(t){return this.config.modelDataRetriever.list(this.config.listPath,this.config.modelPath,t,this.config.idField)},t.prototype.listAsync=function(t){return this.config.modelDataRetriever.listAsync(this.config.listPath,this.config.modelPath,t,this.config.idField)},t.prototype.create=function(t){var e=this.config.modelPath.split("/").slice(0,-1).join("/")+"/";return this.config.modelDataRetriever.create(e,this.config.listPath,t,new this.config.ModelInstance({rawModel:{},modelDataRetriever:this.config.modelDataRetriever,modelPath:this.config.modelPath,idField:this.config.idField}))},t}();t.Model=e,t.smModule.value("SMModel",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this._config=t}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config.config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"props",{get:function(){return this._config.rawModel},enumerable:!0,configurable:!0}),t}();t.ModelListItemInstance=e,t.smModule.value("SMModelListItemInstance",e)}(AngularSmarterModels||(AngularSmarterModels={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},AngularSmarterModels;!function(t){function e(t,e){return t.split("/").map(function(o){if(":"===o[0]){var n=e[o.slice(1)];if(null!==n&&void 0!==n)return n;throw new i('Missing required param "'+o.slice(1)+'" for path "'+t+'"!')}return o}).join("/")}var i=function(t){function e(e){t.call(this,e),this.name="ModelDataRetrieverError"}return __extends(e,t),e}(Error);t.ModelDataRetrieverError=i;var o=function(){function o(t,e){this.$q=t,this.$http=e,this.modelCache={},this.outstandingRequests={},this.listCache={}}return o.prototype.cacheModel=function(t,e,i,o,n){var r=this,s=new i({rawModel:o,modelDataRetriever:r,modelPath:t,listPath:e,idField:n});return this.modelCache[t]=s,this.addModelToList(e,s,0),s},o.prototype.cacheList=function(t,e){return this.listCache[t]=e,e},o.prototype.addModelToList=function(t,e,i){if(void 0===i&&(i=0),this.listCache.hasOwnProperty(t)){for(var o=this.listCache[t],n=0;n<o.length;n++)if(o[n].props[e.config.idField]===e.props[e.config.idField])return void(o[n]=e);this.listCache[t].splice(i,0,e)}},o.prototype.removeModelFromList=function(t,e,i){for(var o=this.listCache[t],n=0;n<o.length;n++)if(o[n].props[i]===e){o.splice(n,1);break}},o.prototype.get=function(t,i,o,n,r){var s=e(t,o);return this.modelCache.hasOwnProperty(s)?this.modelCache[s]:void this.getAsync(t,i,o,n,r)},o.prototype.getAsync=function(t,i,o,n,r){var s,a=this,l=e(t,o);return this.modelCache.hasOwnProperty(l)?s=this.$q.when(this.modelCache[l]):this.outstandingRequests.hasOwnProperty(l)?s=this.outstandingRequests[l]:(s=this.$http.get(l).then(function(t){return a.cacheModel(l,i,n,t.data,r)})["finally"](function(){delete a.outstandingRequests[l]}),this.outstandingRequests[l]=s),s},o.prototype.getMultiple=function(t,o,n,r,s){var a,l=this,h=e(t,n);return this.outstandingRequests.hasOwnProperty(h)?a=this.outstandingRequests[h]:(a=this.$http.get(h).then(function(t){return angular.isArray(t.data)?t.data.map(function(t){return l.cacheModel(h+"/"+t[s],o,r,t,s)}):l.$q.reject(new i('Expected array of models for getMultiple request for path "'+h+'"!'))})["finally"](function(){delete l.outstandingRequests[h]}),this.outstandingRequests[h]=a),a},o.prototype.list=function(t,i,o,n){var r=e(t,o);return this.listCache.hasOwnProperty(r)?this.listCache[r]:void this.listAsync(t,i,o,n)},o.prototype.listAsync=function(o,n,r,s){var a,l=this,h=e(o,r);return this.listCache.hasOwnProperty(h)?a=this.$q.when(this.listCache[h]):this.outstandingRequests.hasOwnProperty(h)?a=this.outstandingRequests[h]:(a=this.$http.get(h).then(function(o){if(!angular.isArray(o.data))return l.$q.reject(new i('Expected array of models for list request for path "'+h+'"!'));var a=o.data.map(function(i){var o=(h={},h[s]=i[s],h);angular.extend(o,r);var a=e(n,o);return l.modelCache.hasOwnProperty(a)?l.modelCache[a]:new t.ModelListItemInstance({rawModel:i,config:{idField:s}});var h});return l.cacheList(h,a)})["finally"](function(){delete l.outstandingRequests[h]}),this.outstandingRequests[h]=a),a},o.prototype.save=function(t){return this.$http.post(t.getModelPath(),t.serialize())},o.prototype.create=function(t,i,o,n){var r=this,s=e(t,o);return this.$http.put(s,n.serialize()).then(function(t){return n.merge(t.data),r.modelCache[t.headers("Location")]=n,r.addModelToList(i,n),n})},o.prototype["delete"]=function(t,e,i){var o,n=this;return this.modelCache.hasOwnProperty(t)&&(o=this.modelCache[t].props[i]),delete this.modelCache[t],this.$http["delete"](t).then(function(t){null!=o&&n.removeModelFromList(e,o,i)})},o.$inject=["$q","$http"],o}();t.ModelDataRetriever=o,t.smModule.value("smModelDataRetrieverError",i).service("smModelDataRetriever",o)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){function e(t,e,o){var n=function(n,r){return new i(n,r,t,e,o,"id")};return n}var i=function(){function t(t,e,i,o,n,r){this.route=t,this._listPath=e,this.Model=i,this.ModelInstance=o,this._modelDataRetriever=n,this._idField=r}return t.prototype.model=function(t){return this.Model=t,this},t.prototype.modelInstance=function(t){return this.ModelInstance=t,this},t.prototype.modelDataRetriever=function(t){return this._modelDataRetriever=t,this},t.prototype.listPath=function(t){return this._listPath=t,this},t.prototype.idField=function(t){return this._idField=t,this},t.prototype.done=function(){return new this.Model({modelPath:this.route,ModelInstance:this.ModelInstance,modelDataRetriever:this._modelDataRetriever,listPath:this._listPath,idField:this._idField})},t}();t.ModelBuilder=i,e.$inject=["SMModel","SMModelInstance","smModelDataRetriever"],angular.module("sm.models").factory("smModelFactory",e)}(AngularSmarterModels||(AngularSmarterModels={}));
//# sourceMappingURL=angular-smarter-models.min.js.map