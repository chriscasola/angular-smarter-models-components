var AngularSmarterModels;!function(t){t.smModule=angular.module("sm.models",[])}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t,angular.isObject(this.config.rawModel)||(this.config.rawModel={})}return Object.defineProperty(t.prototype,"props",{get:function(){return this.config.rawModel},enumerable:!0,configurable:!0}),t.prototype.serialize=function(){return JSON.stringify(this.config.rawModel)},t.prototype.merge=function(t){angular.extend(this.config.rawModel,t)},t.prototype.setModelPath=function(t){this.config.modelPath=t},t.prototype.getModelPath=function(){return this.config.modelPath},t.prototype.save=function(){return this.config.modelDataRetriever.save(this)},t.prototype["delete"]=function(){return this.config.modelDataRetriever["delete"](this.config.modelPath,this.config.listPath,this.config.idField)},t}();t.ModelInstance=e,t.smModule.value("SMModelInstance",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this.config=t}return t.prototype.get=function(t){return this.config.modelDataRetriever.get(this.config.modelPath,this.config.listPath,t,this.config.ModelInstance,this.config.idField)},t.prototype.getAsync=function(t){return this.config.modelDataRetriever.getAsync(this.config.modelPath,this.config.listPath,t,this.config.ModelInstance,this.config.idField)},t.prototype.list=function(t){return this.config.modelDataRetriever.list(this.config.listPath,this.config.modelPath,t,this.config.idField)},t.prototype.listAsync=function(t){return this.config.modelDataRetriever.listAsync(this.config.listPath,this.config.modelPath,t,this.config.idField)},t.prototype.create=function(t,e){var i=this.config.modelPath.split("/").slice(0,-1).join("/")+"/";return this.config.modelDataRetriever.create(i,this.config.listPath,t,new this.config.ModelInstance({rawModel:e,modelDataRetriever:this.config.modelDataRetriever,modelPath:this.config.modelPath,idField:this.config.idField}))},t}();t.Model=e,t.smModule.value("SMModel",e)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){var e=function(){function t(t){this._config=t}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config.config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"props",{get:function(){return this._config.rawModel},enumerable:!0,configurable:!0}),t}();t.ModelListItemInstance=e,t.smModule.value("SMModelListItemInstance",e)}(AngularSmarterModels||(AngularSmarterModels={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},AngularSmarterModels;!function(t){function e(t,e){return t.split("/").map(function(n){if(":"===n[0]){var o=e[n.slice(1)];if(null!==o&&void 0!==o)return o;throw new i('Missing required param "'+n.slice(1)+'" for path "'+t+'"!')}return n}).join("/")}var i=function(t){function e(e){t.call(this,e),this.name="ModelDataRetrieverError"}return __extends(e,t),e}(Error);t.ModelDataRetrieverError=i;var n=function(){function n(t,e){this.$q=t,this.$http=e,this.modelCache={},this.outstandingRequests={},this.listCache={}}return n.prototype.cacheModel=function(t,e,i,n,o){var r=this,s=new i({rawModel:n,modelDataRetriever:r,modelPath:t,listPath:e,idField:o});return this.modelCache[t]=s,this.addModelToList(e,s,0),s},n.prototype.cacheList=function(t,e){return this.listCache[t]=e,e},n.prototype.addModelToList=function(t,e,i){if(void 0===i&&(i=0),this.listCache.hasOwnProperty(t)){for(var n=this.listCache[t],o=0;o<n.length;o++)if(n[o].props[e.config.idField]===e.props[e.config.idField])return void(n[o]=e);this.listCache[t].splice(i,0,e)}},n.prototype.removeModelFromList=function(t,e,i){for(var n=this.listCache[t],o=0;o<n.length;o++)if(n[o].props[i]===e){n.splice(o,1);break}},n.prototype.get=function(t,i,n,o,r){var s=e(t,n);return this.modelCache.hasOwnProperty(s)?this.modelCache[s]:void this.getAsync(t,i,n,o,r)},n.prototype.getAsync=function(t,i,n,o,r){var s,a=this,l=e(t,n);return this.modelCache.hasOwnProperty(l)?s=this.$q.when(this.modelCache[l]):this.outstandingRequests.hasOwnProperty(l)?s=this.outstandingRequests[l]:(s=this.$http.get(l).then(function(t){return a.cacheModel(l,i,o,t.data,r)})["finally"](function(){delete a.outstandingRequests[l]}),this.outstandingRequests[l]=s),s},n.prototype.getMultiple=function(t,n,o,r,s){var a,l=this,h=e(t,o);return this.outstandingRequests.hasOwnProperty(h)?a=this.outstandingRequests[h]:(a=this.$http.get(h).then(function(t){return angular.isArray(t.data)?t.data.map(function(t){return l.cacheModel(h+"/"+t[s],n,r,t,s)}):l.$q.reject(new i('Expected array of models for getMultiple request for path "'+h+'"!'))})["finally"](function(){delete l.outstandingRequests[h]}),this.outstandingRequests[h]=a),a},n.prototype.list=function(t,i,n,o){var r=e(t,n);return this.listCache.hasOwnProperty(r)?this.listCache[r]:void this.listAsync(t,i,n,o)},n.prototype.listAsync=function(n,o,r,s){var a,l=this,h=e(n,r);return this.listCache.hasOwnProperty(h)?a=this.$q.when(this.listCache[h]):this.outstandingRequests.hasOwnProperty(h)?a=this.outstandingRequests[h]:(a=this.$http.get(h).then(function(n){if(!angular.isArray(n.data))return l.$q.reject(new i('Expected array of models for list request for path "'+h+'"!'));var a=n.data.map(function(i){var n=(h={},h[s]=i[s],h);angular.extend(n,r);var a=e(o,n);return l.modelCache.hasOwnProperty(a)?l.modelCache[a]:new t.ModelListItemInstance({rawModel:i,config:{idField:s}});var h});return l.cacheList(h,a)})["finally"](function(){delete l.outstandingRequests[h]}),this.outstandingRequests[h]=a),a},n.prototype.save=function(t){return this.$http.post(t.getModelPath(),t.serialize()).then(function(t){})},n.prototype.create=function(t,i,n,o){var r=this,s=e(t,n);return this.$http.put(s,o.serialize()).then(function(t){return o.merge(t.data),r.modelCache[t.headers("Location")]=o,r.addModelToList(i,o),o})},n.prototype["delete"]=function(t,e,i){var n,o=this;return this.modelCache.hasOwnProperty(t)&&(n=this.modelCache[t].props[i]),delete this.modelCache[t],this.$http["delete"](t).then(function(t){null!=n&&o.removeModelFromList(e,n,i)})},n.$inject=["$q","$http"],n}();t.ModelDataRetriever=n,t.smModule.value("smModelDataRetrieverError",i).service("smModelDataRetriever",n)}(AngularSmarterModels||(AngularSmarterModels={}));var AngularSmarterModels;!function(t){function e(t,e,n){var o=function(o,r){return new i(o,r,t,e,n,"id")};return o}var i=function(){function t(t,e,i,n,o,r){this.route=t,this._listPath=e,this.Model=i,this.ModelInstance=n,this._modelDataRetriever=o,this._idField=r}return t.prototype.model=function(t){return this.Model=t,this},t.prototype.modelInstance=function(t){return this.ModelInstance=t,this},t.prototype.modelDataRetriever=function(t){return this._modelDataRetriever=t,this},t.prototype.listPath=function(t){return this._listPath=t,this},t.prototype.idField=function(t){return this._idField=t,this},t.prototype.done=function(){return new this.Model({modelPath:this.route,ModelInstance:this.ModelInstance,modelDataRetriever:this._modelDataRetriever,listPath:this._listPath,idField:this._idField})},t}();t.ModelBuilder=i,e.$inject=["SMModel","SMModelInstance","smModelDataRetriever"],angular.module("sm.models").factory("smModelFactory",e)}(AngularSmarterModels||(AngularSmarterModels={}));
//# sourceMappingURL=angular-smarter-models.min.js.map